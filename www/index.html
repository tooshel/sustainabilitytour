<!DOCTYPE html>
<html>
  <head>
  <title></title>
  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta charset="utf-8">

        
    <link rel="stylesheet" href="css/common.css" type="text/css" />
    <link rel="stylesheet" href="js/jquery.mobile-1.1.0/jquery.mobile-1.1.0.min.css" />
        
	<!-- iPad/iPhone specific css below, add after your main css >
	<link rel="stylesheet" media="only screen and (max-device-width: 1024px)" href="ipad.css" type="text/css" />		
	<link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="iphone.css" type="text/css" />		
	-->
	<!-- If your application is targeting iOS BEFORE 4.0 you MUST put json2.js from http://www.JSON.org/json2.js into your www directory and include it here -->
    <script type="text/javascript" charset="utf-8" src="js/cordova-1.6.0.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" charset="utf-8">
    $(document).bind("mobileinit", function(){
                     //$.mobile.defaultPageTransition = 'slide';
                     $.mobile.defaultPageTransition = 'none';
                     $.mobile.pushStateEnabled = false;
    });
	    
    </script>
        
        
    <script type="text/javascript" charset="utf-8" src="js/jquery.mobile-1.1.0/jquery.mobile-1.1.0.min.js"></script>

        
        
    <!--
     <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> 
     <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false&libraries=geometry"></script>
    -->
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true&libraries=geometry"></script> 
        

    <script type="text/javascript" charset="utf-8" src="js/arrows.js"></script>

	<script type="text/javascript">


	// If you want to prevent dragging, uncomment this section
	/*
	function preventBehavior(e) 
	{ 
      e.preventDefault(); 
    };
	document.addEventListener("touchmove", preventBehavior, false);
	*/
	
	/* If you are supporting your own protocol, the var invokeString will contain any arguments to the app launch.
	see http://iphonedevelopertips.com/cocoa/launching-your-own-application-via-a-custom-url-scheme.html
	for more details -jm */
	/*
	function handleOpenURL(url)
	{
		// TODO: do something with the url passed in.
	}
	*/
	
	function onBodyLoad()
	{		
		document.addEventListener("deviceready", onDeviceReady, false);
	}
	
	/* When this function is called, Cordova has been initialized and is ready to roll */
	/* If you are supporting your own protocol, the var invokeString will contain any arguments to the app launch.
	see http://iphonedevelopertips.com/cocoa/launching-your-own-application-via-a-custom-url-scheme.html
	for more details -jm */
	function onDeviceReady()
	{
		// do your thing!
		//navigator.notification.alert("Cordova is working")
	}
    
	</script>

</head>
<body onload="onBodyLoad()">
    <div id="scriptHolder"></div>
    
    
    
    
    <div data-role="page" id="map-page" >
        <div data-role="header" data-position="fixed" data-theme="">
            <h3>Initiatives Tour</h3>
            <a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-right jqm-home" data-ajax="false">Home</a>
        
            <a href="index.html#list" data-transition="fade" data-type="horizontal" data-icon="grid" data-iconpos="left" data-direction="reverse" class="ui-btn-left">List</a>
        </div>
        
        
        <div data-role="content" id="map_content" data-theme="">
            <div id="map_content">
                <div id="cm_map" style="width:100%; height:100%"></div>
            </div>
            <div id="points"></div>
            <div id="cm_mapTR"></div>
        </div>
    </div>
    
    

    
        
    <div data-role="page" id="list" data-add-back-btn="true">  
        <div data-role="header" data-position="fixed" data-theme="">
            <h3>Initiatives Tour</h3>
            <a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-right jqm-home" data-ajax="false">Home</a>
            
        </div>

        <div data-role="content"> 
            <ul data-role="listview" id="list"><!-- Special Widget which is List View to show data in a list -->
            
            </ul> 

        </div>
        
    </div>

    
    <div data-role="page" id="location" data-add-back-btn="true">  
        <div data-role="header" data-position="fixed" data-theme="">
            <h3>Tour Details</h3>
            <a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-right jqm-home" data-ajax="false">Home</a>
            
        
        </div>
        
        <div data-role="content"> 
            <ul data-role="listview" id="list"><!-- Special Widget which is List View to show data in a list -->
                    <!-- This all gets replaced with js -->
            </ul> 
            
        </div>
    </div>

    <div data-role="page" id="splash" data-add-back-btn="true">  
        <div data-role="header" data-position="fixed" data-theme="">
            <h3>Tour Details</h3>
            <a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-right jqm-home" data-ajax="false">Home</a>
        </div>
        
        <div data-role="content"> 
            <img width="295" src="images-other/Default.png" />
            <br><br>
            <p>
            <img width="72" src="images-other/icon-72.png" />
            </p>
        </div>
    </div>
    
    <div data-role="page" id="credits" data-add-back-btn="true">  
        <div data-role="header" data-position="fixed" data-theme="">
            <h3>Tour Details</h3>
            <a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-right jqm-home" data-ajax="false">Home</a>
            
            
        </div>
        
        <div data-role="content">
            <h1>People</h1>
                <h2>Claire! Thanks for help with the data and images!</h2>
            <h1>Technology/Tools</h1>
                <h2>PhoneGap</h2>
                <h2>jQuery</h2>
                <h2>jQuery UI</h2>
                <h2>Google Docs</h2>
        </div>
    </div>

 
 
    
<script type="text/javascript"> 
    
    //<![CDATA[
    var cm_map;
    var cm_openInfowindow;
    var cm_mapMarkers = [];
    var cm_mapHTMLS = [];
    
    // Change these parameters to customize map
    //http://spreadsheets.google.com/ccc?key=0AkgK5DH1oB63dExWZm12Sjc5bEhhWTNjaDRSMVlmb2c&hl=en
    //http://spreadsheets.google.com/feeds/list/tLVfmvJ79lHaY3ch4R1Yfog/od6/public/basic
    //http://spreadsheets.google.com/feeds/cells/tLVfmvJ79lHaY3ch4R1Yfog/od6/public/basic
    
    var param_wsId = "od6";
    //var param_ssKey = "tLVfmvJ79lHaY3ch4R1Yfog";
    
    
    var param_ssKey = "0AkgK5DH1oB63dGhGUUx3TlJtcDdrSFpJYlFTN0pqcnc"; //Tour map locations
    var param_ssKey = "0AkgK5DH1oB63dEw4ZHZpSmRGWlNJV2N2U1FwTjhwb1E"; //Sustainability Initiatives Tour
    
    
    //var param_useSidebar = true;
    var param_useSidebar = false;
    
    var param_idColumn = "locid";
    var param_titleColumn = "title";
    var param_descriptionColumn = "description";
    var param_latColumn = "lat";
    var param_lngColumn = "lng";
    var param_rankColumn = "rank";
    var param_descColumn = "description";
    var param_imageColumn = "image";
    var param_iconType = "red";
    var param_iconOverType = "orange";
    var param_iconColumn = "icon";
    var param_iconPath = "icons/20/";
    var param_iconPathOriginal = "icons/";
    var param_imagePath = "images/";
    
    var myCoordinates = [
                         new google.maps.LatLng(33.418340,-111.934457),
                         new google.maps.LatLng(33.418304,-111.932697),
                         new google.maps.LatLng(33.416137,-111.932697),
                         new google.maps.LatLng(33.416110,-111.934972),
                         new google.maps.LatLng(33.417122,-111.934972),
                         new google.maps.LatLng(33.417122,-111.936131),
                         new google.maps.LatLng(33.417642,-111.936141),
                         new google.maps.LatLng(33.417651,-111.936624),
                         new google.maps.LatLng(33.420275,-111.936603),
                         new google.maps.LatLng(33.420283,-111.935186),
                         new google.maps.LatLng(33.421815,-111.935176),
                         new google.maps.LatLng(33.421815,-111.934961),
                         new google.maps.LatLng(33.418519,-111.934972),
                         new google.maps.LatLng(33.418475,-111.934886),
                         new google.maps.LatLng(33.418448,-111.934693),
                         new google.maps.LatLng(33.418358,-111.934532)
                         ];
    
    var mapStyles =    [
                        {
                        featureType: "poi",
                        stylers: [
                                  { visibility: "off" }
                                  ]
                        }
                        ];
    
    
    var polyOptions = {
        path: myCoordinates,
        strokeColor: "#FF0000",
        strokeOpacity: .7,
        strokeWeight: 8
    }
    
    

    function find_in_array(arr, name, value) {
        for (var i = 0, len = arr.length; i<len; i++) {
            if (name in arr[i] && arr[i][name] == value) return i;
        };
        return false;
    }
    
    function showCategory( urlObj, options ){
        console.log("showCategory called");
        //var categoryName = urlObj.hash.replace( /.*category=/, "" );
        var locationID = urlObj.hash.replace( /.*locationid=/, "" );
        var marker = find_in_array(cm_mapMarkers, 'locid', locationID);
        
        console.log(urlObj.hash, locationID, marker, cm_mapMarkers[marker]);
        
        
		// Get the object that represents the category we
		// are interested in. Note, that at this point we could
		// instead fire off an ajax request to fetch the data, but
		// for the purposes of this sample, it's already in memory.
		//var category = categoryData[ categoryName ];
                
		// The pages we use to display our content are already in
		// the DOM. The id of the page we are going to write our
		// content into is specified in the hash before the '?'.
		var pageSelector = urlObj.hash.replace( /\?.*$/, "" );        
        
        if (typeof marker === 'number') {
            // Get the page we are going to dump our content into.
            var $page = $( pageSelector );
            
			// Get the header for the page.
			var $header = $page.children( ":jqmData(role=header)" );
            
			// Get the content area element for the page.
			var $content = $page.children( ":jqmData(role=content)" );
            
			// The markup we are going to inject into the content
			// area of the page.
            
			var markup = "";
            markup += '<h2><img align="absmiddle" class="ui-li-icon my-title-icon" src="'+cm_mapMarkers[marker].listicon+'"/>' + cm_mapMarkers[marker].title + '</h2>';
            markup += '<p>' + cm_mapMarkers[marker].desc + '</p>';
            markup += '<img class="auto" src="' + cm_mapMarkers[marker].image + '" />';
            
			//markup = "<p>" + category.description + "</p><ul data-role='listview' data-inset='true'>",
            //markup += "<ul data-role='listview' data-inset='true'>";
            
			// The array of items for this category.
			//cItems = category.items,
            
			// The number of items in the category.
			//numItems = cItems.length;
            
            // Generate a list item for each item in the category
            // and add it to our markup.
            //for ( var i = 0; i < numItems; i++ ) {
            //    markup += "<li>" + cItems[i].name + "</li>";
            //}
            //markup += "</ul>";
            
            // Find the h1 element in our header and inject the name of
            // the category into it.
            //$header.find( "h1" ).html( category.name );
            
            // Inject the category items markup into the content element.
            
            //console.log($content);
            $content.html( markup );
            
            // Pages are lazily enhanced. We call page() on the page
            // element to make sure it is always enhanced before we
            // attempt to enhance the listview markup we just injected.
            // Subsequent calls to page() are ignored since a page/widget
            // can only be enhanced once.
            $page.page();
            
            // Enhance the listview we just injected.
            //$content.find( ":jqmData(role=listview)" ).listview();
            
            // We don't want the data-url of the page we just modified
            // to be the url that shows up in the browser's location field,
            // so set the dataUrl option to the URL for the category
            // we just loaded.
            options.dataUrl = urlObj.href;
            
            // Now call changePage() and tell it to switch to
            // the page we just modified.
            $.mobile.changePage( $page, options );
        }
    }
    
    function showList( urlObj, options ){
        console.log("showList called");
        
        //var locationID = urlObj.hash.replace( /.*locationid=/, "" );
        //var marker = find_in_array(cm_mapMarkers, 'locid', locationID);
        //console.log(urlObj.hash, locationID, marker, cm_mapMarkers[marker]);
        
        
		// The pages we use to display our content are already in
		// the DOM. The id of the page we are going to write our
		// content into is specified in the hash before the '?'.
		var pageSelector = urlObj.hash.replace( /\?.*$/, "" );        
        
        if (!cm_mapMarkers) {
            console.log("missing markers!");
        } else {
            // Get the page we are going to dump our content into.
            var $page = $( pageSelector );
            
			// Get the header for the page.
			var $header = $page.children( ":jqmData(role=header)" );
            
			// Get the content area element for the page.
			var $content = $page.children( ":jqmData(role=content)" );
            
			// The markup we are going to inject into the content
			// area of the page.
            
			var markup = "";
            markup += '<ul data-mini="true" data-role="listview" id="list">';
            
            
            numItems = cm_mapMarkers.length;
            for ( var i = 0; i < numItems; i++ ) {
                markup += '<li><a data-transition="slide" href="#location?locationid='+cm_mapMarkers[i].locid+'"><img class="ui-li-icon my-ui-li-icon" src="'+cm_mapMarkers[i].listicon+'"/>'+cm_mapMarkers[i].title+'</a></li>';
            }
            markup += '<li data-role="list-divider" role="heading" class="ui-li ui-li-divider ui-bar-b">Extras</li>'
            markup += '<li><a data-transition="slide" href="#splash">Splash Screen/Icon</a></li>';
            markup += '<li><a data-transition="slide" href="#credits">Credits</a></li>';
            
                        
            markup += '</ul>';
            
            
            
			// The array of items for this category.
			//cItems = category.items,
            
			// The number of items in the category.
			//numItems = cItems.length;
            
            // Generate a list item for each item in the category
            // and add it to our markup.
            //for ( var i = 0; i < numItems; i++ ) {
            //    markup += "<li>" + cItems[i].name + "</li>";
            //}
            //markup += "</ul>";
            
            // Find the h1 element in our header and inject the name of
            // the category into it.
            //$header.find( "h1" ).html( category.name );
            
            // Inject the category items markup into the content element.
            
            $content.html( markup );
            $page.page();
            
            // Enhance the listview we just injected.
            $content.find( ":jqmData(role=listview)" ).listview();
            
            // We don't want the data-url of the page we just modified
            // to be the url that shows up in the browser's location field,
            // so set the dataUrl option to the URL for the category
            // we just loaded.
            options.dataUrl = urlObj.href;
            
            // Now call changePage() and tell it to switch to
            // the page we just modified.
            $.mobile.changePage( $page, options );
        }
    }
    
    
    // Listen for any attempts to call changePage().
    $(document).bind( "pagebeforechange", function( e, data ) {
        // We only want to handle changePage() calls where the caller is
        // asking us to load a page by URL.
        if ( typeof data.toPage === "string" ) {
            // We are being asked to load a page by URL, but we only
            // want to handle URLs that request the data for a specific
            // category.
            var u = $.mobile.path.parseUrl( data.toPage );
            var re = /^#location/;
            if ( u.hash.search(re) !== -1 ) {
                // We're being asked to display the items for a specific category.
                // Call our internal method that builds the content for the category
                // on the fly based on our in-memory category data structure.
                //console.log(u, data.options);
                showCategory( u, data.options );
                // Make sure to tell changePage() we've handled this call so it doesn't
                // have to do anything.
                e.preventDefault();
            }
                     
            var re = /^#list/;
            if ( u.hash.search(re) !== -1 ) {
                // We're being asked to display the items for a specific category.
                // Call our internal method that builds the content for the category
                // on the fly based on our in-memory category data structure.
                //console.log(u, data.options);
                showList( u, data.options );
                // Make sure to tell changePage() we've handled this call so it doesn't
                // have to do anything.
                e.preventDefault();
            }        
        }
    });    
    
    
    
    /**
     * Loads map and calls function to load in worksheet data.
     */
    function cm_load() {  
        var myLatlng = new google.maps.LatLng(33.41861700652633, -111.93455144762993);
        var myOptions = {
            zoom: 16,
            center: myLatlng,
            disableDoubleClickZoom: true,
            streetViewControl: false,
            overviewMapControl: false,
            panControl: false,
            mapTypeControl: false,
            style: mapStyles,
            /*
             mapTypeControl: false,
            */
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        cm_map = new google.maps.Map(document.getElementById("cm_map"), myOptions);
        
        
        var it = new google.maps.Polyline(polyOptions);
        //setArrows = new ArrowHandler();
        //var it = createPoly(myCoordinates, "onset");
        
        
        it.setMap(cm_map);
        
        /*
         
         */
        
        if(window.location.search == "?dragme=true") {
            console.log(window.location.search);
            google.maps.event.addListener(cm_map, 'click', function(event) {
                                          placeMarker(event.latLng);
                                          });
            
            google.maps.event.addListener(cm_map, 'doubleclick', function(event) {
                                          placeMarker(event.latLng);
                                          });
        }
        
        
        
        cm_getJSON();
        
        
    }
 
    
    function placeMarker(location) {
        $('#points').append("<br>" + location.lat() + ", " +location.lng() + "");
        console.log(location.lat() + "\t " +location.lng()); 
    }
    
    function cm_ViewAll() {  
        var myLatlng = new google.maps.LatLng(33.4164856840978,-111.93096801638603);
        cm_map.setCenter(myLatlng);
        cm_map.setZoom(14);
        if (cm_openInfowindow != undefined) {
            cm_openInfowindow.close();
        }
    }

    
    /**
     * Function called when marker on the map is clicked.
     * Opens an info window (bubble) above the marker.
     * @param {Number} markerNum Number of marker in global array
     */
    function cm_markerClicked(markerNum) {
        
        /*
        var infowindowOptions = {
            content: cm_mapHTMLS[markerNum]
        }
        
        
        var infowindow = new google.maps.InfoWindow(infowindowOptions);
        cm_map.setCenter(cm_mapMarkers[markerNum].position);
        cm_map.setZoom(18);
        infowindow.open(cm_map, cm_mapMarkers[markerNum]);
        cm_setInfowindow(infowindow);

         */
        
    }
    
    /**
     * Function that sorts 2 worksheet rows from JSON feed
     * based on their rank column. Only called if column is defined.
     * @param {rowA} Object Represents row in JSON feed
     * @param {rowB} Object Represents row in JSON feed
     * @return {Number} Difference between row values
     */
    function cm_sortRows(rowA, rowB) {
        var rowAValue = parseFloat(rowA["gsx$" + param_rankColumn].$t);
        var rowBValue = parseFloat(rowB["gsx$" + param_rankColumn].$t);
        
        return rowAValue - rowBValue;
    }
    
    /** 
     * Called when JSON is loaded. Creates sidebar if param_sideBar is true.
     * Sorts rows if param_rankColumn is valid column. Iterates through worksheet rows, 
     * creating marker and sidebar entries for each row.
     * @param {JSON} json Worksheet feed
     */       
    function cm_loadMapJSON(json) {
        var usingRank = false;
        
        if(param_useSidebar == true) {
            var sidebarTD = document.createElement("td");
            //sidebarTD.setAttribute("width","240");
            sidebarTD.setAttribute("valign","top");
            var sidebarDIV = document.createElement("div");
            sidebarDIV.id = "cm_sidebarDIV";
            sidebarDIV.style.overflow = "auto";
            sidebarDIV.style.height = "400px";
            sidebarDIV.style.fontSize = "12px";
            sidebarDIV.style.color = "#000000";
            sidebarTD.appendChild(sidebarDIV);
            document.getElementById("cm_mapTR").appendChild(sidebarTD);
        }
        
        var bounds = new google.maps.LatLngBounds();
        if(json.feed.entry[0]["gsx$" + param_rankColumn]) {
            usingRank = true;
            json.feed.entry.sort(cm_sortRows);
        }
        
        for (var i = 0; i < json.feed.entry.length; i++) {
            var entry = json.feed.entry[i];
            if(entry["gsx$" + param_latColumn]) {
                var lat = parseFloat(entry["gsx$" + param_latColumn].$t);
                var lng = parseFloat(entry["gsx$" + param_lngColumn].$t);
                var icon = entry["gsx$" + param_iconColumn].$t;
                var point = new google.maps.LatLng(lat,lng);
                var html = "<div style='font-size:12px'>";
                
                //html += "<strong>" + entry["gsx$"+param_titleColumn].$t + "</strong>";
                //html += "<strong>" + entry["gsx$"+param_titleColumn].$t + "</strong>";
                var label = entry["gsx$"+param_titleColumn].$t;
                var locid = entry["gsx$"+param_idColumn].$t;
                var desc = entry["gsx$"+param_descColumn].$t;
                var image = entry["gsx$"+param_imageColumn].$t;
                
                
                var rank = 0;
                
                
                if(usingRank && entry["gsx$" + param_rankColumn]) {
                    rank = parseInt(entry["gsx$"+param_rankColumn].$t);
                }
                if(entry["gsx$" + param_descriptionColumn]) {
                    //html += "<br/>" + entry["gsx$"+param_descriptionColumn].$t;
                    html += entry["gsx$"+param_descriptionColumn].$t;
                }
                html += "</div>";
                
                // create the marker
                if(lat && lng) {
                    console.log(i, locid, lat, lng, icon);
                    var marker = cm_createMarker(cm_map,point,label,html,icon,locid,desc,image);
                   
                    cm_mapMarkers.push(marker);
                    cm_mapHTMLS.push(html);
                    //bounds.extend(point);
                    //cm_map.addOverlay(marker);
                    
                }
                                
                if(param_useSidebar == true) {
                    var markerA = document.createElement("a");
                    markerA.setAttribute("href","javascript:cm_markerClicked('" + i +"')");
                    markerA.style.color = "#000000";
                    markerA.style.textDecoration = "none";
                    
                    var sidebarText= "";
                    if(usingRank) {
                        sidebarText += rank + ") ";
                    } 
                    sidebarText += label;
                    markerA.appendChild(document.createTextNode(sidebarText));
                    sidebarDIV.appendChild(markerA);
                    //sidebarDIV.appendChild(document.createElement("br"));
                    sidebarDIV.appendChild(document.createElement("br"));
                } 
            }
        }
        
        if(param_useSidebar == true) {
            var markerA = document.createElement("a");
            markerA.setAttribute("href","javascript:cm_ViewAll()");
            markerA.style.color = "#000000";
            markerA.style.textDecoration = "none";
            var sidebarText= "View All";
            sidebarDIV.appendChild(document.createElement("br"));
            sidebarDIV.appendChild(document.createElement("br"));
            markerA.appendChild(document.createTextNode(sidebarText));
            sidebarDIV.appendChild(markerA);
            sidebarDIV.appendChild(document.createElement("br"));
        }
        
        //cm_map.fitBounds(bounds);
        //cm_map.setCenter(bounds.getCenter());
        
    }
    
    function cm_setInfowindow(newInfowindow) {
        if (cm_openInfowindow != undefined) {
            cm_openInfowindow.close();
        }
        
        cm_openInfowindow = newInfowindow;
    }
    
    /**
     * Creates marker with ranked Icon or blank icon,
     * depending if rank is defined. Assigns onclick function.
     * @param {GLatLng} point Point to create marker at
     * @param {String} title Tooltip title to display for marker
     * @param {String} html HTML to display in InfoWindow
     * @param {Number} rank Number rank of marker, used in creating icon
     * @return {GMarker} Marker created
     */
    function cm_createMarker(map, latlng, title, html, icon, locid, desc, image) {
        var iconSize = new google.maps.Size(20, 20);
        var scaledIconSize = new google.maps.Size(10, 10);
        
        
        var iconShadowSize = new google.maps.Size(0, 0);
        var iconHotSpotOffset = new google.maps.Point(0, 0); // Should this be (9, 34)?
        var iconPosition = new google.maps.Point(0, 0);
        var infoWindowAnchor = new google.maps.Point(9, 2);
        var infoShadowAnchor = new google.maps.Point(18, 25);
        
        //var iconShadowUrl = "http://www.google.com/mapfiles/shadow50.png";
        var iconShadowUrl = "";
        var iconImageUrl;
        var iconImageOverUrl;
        var iconImageOutUrl;
        
        if(icon) {
            iconImageOutUrl  = param_iconPath + icon;
            iconImageOverUrl = param_iconPath + icon;
            iconImageUrl     = iconImageOutUrl;
        } else {
            /*
            iconImageOutUrl = "http://gmaps-samples.googlecode.com/svn/trunk/" +
            "markers/" + param_iconType + "/blank.png";
            iconImageOverUrl = "http://gmaps-samples.googlecode.com/svn/trunk/" +
            "markers/" + param_iconOverType + "/blank.png";
            iconImageUrl = iconImageOutUrl;
             */
        }
        
        /*
        var markerImage =
        new google.maps.MarkerImage(iconImageUrl, iconSize,
                                    iconPosition, iconHotSpotOffset, scaledIconSize);
        */
        var markerImage =
        new google.maps.MarkerImage(iconImageUrl);

        var markerShadow =
        new google.maps.MarkerImage(iconShadowUrl, iconShadowSize,
                                    iconPosition, iconHotSpotOffset, scaledIconSize);
        var markerImageOver =
        new google.maps.MarkerImage(iconImageOverUrl, iconSize,
                                    iconPosition, iconHotSpotOffset, scaledIconSize);
        
        var markerImageOut =
        new google.maps.MarkerImage(iconImageOutUrl, iconSize,
                                    iconPosition, iconHotSpotOffset, scaledIconSize);
        
        var markerOptions = {
            title: title,
            icon: markerImage,
            /* shadow: markerShadow,
             
             */
            draggable:true,
            position: latlng,
            map: map
        }
        
        var marker = new google.maps.Marker(markerOptions);
        marker.locid = locid;
        marker.desc = desc;
        marker.originalicon = param_iconPathOriginal+icon;
        marker.listicon = param_iconPath+icon;
        marker.image = param_imagePath + image;

        
        google.maps.event.addListener (marker, 'dragend', function (event) 
                                       {
                                       console.log(marker.locid, marker.position.lat() + "\t" + marker.position.lng());
                                       });
        
        google.maps.event.addListener(marker, "click", function() {
                                      
                                      //console.log(marker);
                                      
                                      //#location?locationid=2
                                      
                                      document.location.href = "index.html#location?locationid="+marker.locid;
                                      
                                      /*
                                      var infowindowOptions = {content: html}
                                      var infowindow = new google.maps.InfoWindow(infowindowOptions);
                                      cm_setInfowindow(infowindow);
                                      infowindow.open(map, marker);
                                      marker.setIcon(markerImageOut);
                                      */
                                      
                                      
                                      });
        /*
        google.maps.event.addListener(marker, "mouseover", function() {
                                      marker.setIcon(markerImageOver);
                                      });
        google.maps.event.addListener(marker, "mouseout", function() {
                                      marker.setIcon(markerImageOut);
                                      });
        */
        return marker;
    }
    
    /**
     * Creates a script tag in the page that loads in the 
     * JSON feed for the specified key/ID. 
     * Once loaded, it calls cm_loadMapJSON.
     */
    function cm_getJSON() {
        
        // Retrieve the JSON feed.
        var script = document.createElement('script');
        
        script.setAttribute('src', 'http://spreadsheets.google.com/feeds/list'
                            + '/' + param_ssKey + '/' + param_wsId + '/public/values' +
                            '?alt=json-in-script&callback=cm_loadMapJSON');
        script.setAttribute('id', 'jsonScript');
        script.setAttribute('type', 'text/javascript');
        //document.documentElement.firstChild.appendChild(script);
        $("#scriptHolder").append(script);
    }
    
    cm_load();
    //setTimeout('cm_load()', 500); 
    
    //]]>
    
</script> 
	
</td></tr> 
</table> 


<script>
    $(function() {
      
      /*
       $("div:jqmData(role='page'):last").bind('pageinit', function() {
       alert('pageInit');
       });
       
       $(document).bind( "pagechange", function( e, data ) {
       alert('pagechange');
       });
       */
      $('#map-page').live('pageshow',function(event){
                          //This is the call that works when the map reloads . . . just neeed to know what to do here!
                          //alert("map-page pageshow");
                          
                          
                          /*
                          
                          var mapheight=$(window).height() - 263;
                          var mapwidth=$(window).width();
                          $("#cm_map").height(mapheight);
                          $("#cm_map").width(mapwidth);
                          //setTimeout("cm_load()",150);
                          */
                          
                          });
      
      
      
      $("#map_content").live('pageshow', function() {
                             alert("map_content pageshow");
                             
                             /*
                              var mapheight=$(window).height() - 263;
                              var mapwidth=$(window).width();
                              $("#cm_map").height(mapheight);
                              $("#cm_map").width(mapwidth);
                              setTimeout("cm_load()",150);
                              
                              */
                             
                             });
      
      });
</script>
</body>
</html>
